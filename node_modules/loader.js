var Loader = (function() {
	
	var fs = require('fs');
	var Trace = require('trace');

	var Loader = {

		loadData: function(filepath) {
			console.log('Reading file...');
			data = fs.readFileSync(filepath, {encoding: 'utf-8'});

		    
			console.log('Processing data...');
		    var tracesList = [];
		    try {
		    	// JSON processing
			    JSON.parse(data, function(key, value) {
			    	if (key == 'header') {
						return;
					}
			    	
			    	if (key == 'data') {
			    		tracesList = tracesList.concat(value);
			    		return;
					}
			    	
			    	return value;
				});

			    // Trace object building
			    tracesList.forEach(function(value, index, array) {
					array[index] = new Trace(
							value['time'], 
							value['lon'], 
							value['lat'], 
							value['accuracy'], 
							value['speed']);
				});

			} catch(e) {
			    console.error('Parsing error:', e); 
			}

			return tracesList;
		}
	};

	return Loader;

}());

module.exports = Loader;