var Loader = (function() {
	
	var fs = require('fs');
	var Trace = require('trace');

	var Loader = {

		loadData: function(filepath) {
			console.log('Reading file...');
			data = fs.readFileSync(filepath, {encoding: 'utf-8'});

		    
			console.log('Processing data...');
		    var tracesList = [];
		    try {
			    JSON.parse(data, function(key, value) {
					if (key == 'data') {
						trace = new Trace(value['timestamp'], 
								value['lon'], value['lat'], 
								value['accuracy'], value['speed']);
						tracesList.push(trace);
					}

					return value;
				});
			    
			} catch(e) {
			    console.error('Parsing error:', e); 
			}

			return tracesList;
		}
	};

	return Loader;

}());

module.exports = Loader;