/**
 * This class models a GPS coordinate with an associated accuracy value
 */
var Coordinate = (function() {
	'use strict';

	function Coordinate(timestamp, latitude, longitude, accuracy) {
		this.timestamp = timestamp;
		this.latitude = latitude;
		this.longitude = longitude;
		this.accuracy = accuracy;
	}

	/**
	 * Compute the distance between the current coordinate
	 * and the given one by using the Haversine formula.
	 * 
	 * @param coord {@link Coordinate}
	 * 
	 * @source http://www.movable-type.co.uk/scripts/latlong.html
	 */
	Coordinate.prototype.distance = function(coord) {
		var R = 6371; // Earth radius in km
		
		var dLat = (coord.latitude - this.latitude) * Math.PI / 180;
		var dLon = (coord.longitude - this.longitude) * Math.PI / 180;
		var lat1 = this.latitude * Math.PI / 180;
		var lat2 = coord.latitude * Math.PI / 180;

		var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
		        Math.sin(dLon / 2) * Math.sin(dLon / 2) * Math.cos(lat1) * Math.cos(lat2); 
		var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)); 
		var d = R * c;
		
		return d;
	};
	
	/**
	 * Return the moving speed between the current position and 
	 * the given position.
	 * 
	 * @param coord {@link Coordinate}
	 * @returns {Number}
	 */
	Coordinate.prototype.speed = function(coord) {
		var d = this.distance(coord);
		var t = coord.timestamp - this.timestamp;
		
		return (d / t) * 3600 * 1000;
	};

	
	Coordinate.prototype.toString = function() {
		return this.longitude + ', ' + this.latitude;
	};

	return Coordinate;

}());

module.exports = Coordinate;